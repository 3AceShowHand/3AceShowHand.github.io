<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>闲杂小记</title><link>https://3AceShowHand.github.io/</link><description>Recent content on 闲杂小记</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Mon, 21 Nov 2022 17:21:49 +0800</lastBuildDate><atom:link href="https://3AceShowHand.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>About</title><link>https://3AceShowHand.github.io/about/</link><pubDate>Sat, 10 Sep 2022 15:21:00 +0800</pubDate><guid>https://3AceShowHand.github.io/about/</guid><description>&lt;p>一个程序员，随便写写&lt;/p></description></item><item><title>Br</title><link>https://3AceShowHand.github.io/post/br/</link><pubDate>Mon, 21 Nov 2022 17:21:49 +0800</pubDate><guid>https://3AceShowHand.github.io/post/br/</guid><description>&lt;ol>
&lt;li>br 的应用场景&lt;/li>
&lt;li>什么是全量备份&lt;/li>
&lt;/ol>
&lt;p>全量备份是对集群某个时间点的全量数据进行备份。&lt;/p>
&lt;ol start="3">
&lt;li>什么是 PITR&lt;/li>
&lt;/ol>
&lt;h1 id="backup-工作过程">Backup 工作过程&lt;/h1>
&lt;pre tabindex="0">&lt;code>tiup br backup db --db=sysbench --pd=http://10.2.7.4:2379 --storage=&amp;#34;s3://db-sysbench-300?access-key=minioadmin&amp;amp;secret-access-key=minioadmin&amp;amp;endpoint=http%3a%2f%2f10.2.7.72:9199&amp;amp;force-path-style=true&amp;#34; --send-credentials-to-tikv=true
&lt;/code>&lt;/pre>&lt;p>backup ts 是什么。基于 TiDB MVCC 实现的快照备份，backup-ts 指定了备份的 tso。&lt;/p>
&lt;p>备份存储地址&lt;/p>
&lt;p>告知 tikv 对目标 regions 进行备份&lt;/p>
&lt;p>tikv 侧的 backup worker&lt;/p>
&lt;p>数据备份 -&amp;gt; 元信息备份&lt;/p>
&lt;p>是否备份索引等数据？&lt;/p>
&lt;p>如何对备份数据进行压缩？ztsd&lt;/p>
&lt;p>前置检查，连接 pd，tikv&lt;/p>
&lt;p>创建 client -&amp;gt; 创建 backup storage -&amp;gt; 检查 backup storage 的可用性，不能有其他 backup 正在使用该 storage -&amp;gt; 对 backup storage 上 file lock -&amp;gt; 修改 gc ttl -&amp;gt; 生成 backup ts&lt;/p>
&lt;p>启动 safe point keeper，周期性更新 gc safe point。&lt;/p>
&lt;p>拿到需要被备份的 ranges，schemas，placement polies&lt;/p>
&lt;p>创建 &lt;code>backupRequest&lt;/code>, StartVersion &amp;lt;-&amp;gt; EndVersion。&lt;/p>
&lt;p>&lt;code>client.BackupRanges&lt;/code>，按照 range 备份，并行执行。分别调用 &lt;code>client.BackupRange&lt;/code>。&lt;/p>
&lt;p>&lt;code>metaWriter.FinishWriteMetas&lt;/code>&lt;/p>
&lt;p>备份 schemas：对每个 schema 计算 checksum，将 table 的统计信息导出到 json。&lt;/p>
&lt;p>schema 是什么？&lt;/p>
&lt;p>备份过程中，执行了 DDL 怎么办？&lt;/p>
&lt;p>备份过程中，发生了 region 变化怎么办？&lt;/p>
&lt;p>Full&lt;/p>
&lt;p>DB&lt;/p>
&lt;p>Table&lt;/p>
&lt;p>Raw&lt;/p>
&lt;h1 id="restore-过程">Restore 过程&lt;/h1>
&lt;h1 id="pitr">PITR&lt;/h1></description></item><item><title>introduce</title><link>https://3AceShowHand.github.io/post/first-blog/</link><pubDate>Sat, 10 Sep 2022 16:32:34 +0800</pubDate><guid>https://3AceShowHand.github.io/post/first-blog/</guid><description>&lt;p>先写点什么东西，比如 tags / categories，占个位置，看起来不那么空空如也。&lt;/p>
&lt;p>至于写点文章什么的，以后再说吧。&lt;/p></description></item></channel></rss>